SLASH_CEPGPBR1 = "/cepgpigp"
SLASH_CEPGPBR2 = "/cepigp"
function SlashCmdList.CEPGPBR(msg, editbox) 
    if msg == "" then
        CEPIGP_StaticPopupImport()
    elseif msg == "t" then 
        CEPGP_override:Show()
    elseif msg == "test" then
        print("test")
        CEPIGP_Test()
    end
end


function CEPIGP_Test()
    C_Timer.After(3, function() print("Hello") end)
end



function CEPIGP_StaticPopupImport()
    
    StaticPopupDialogs["CEPIGP_IMPORT"] =
        StaticPopupDialogs["CEPIGP_IMPORT"] or
        {
            text = "Paste Import String:",
            button1 = "Import",
            hasEditBox = 1,
            hasWideEditBox = 1,
            editBoxWidth = 350,
            preferredIndex = 3,
            OnShow = function(this, ...)
                this:SetWidth(420)

                local editBox = _G[this:GetName() .. "WideEditBox"] or _G[this:GetName() .. "EditBox"]

                editBox:SetText("[19146] = 50, [19147] = 58, [18821] = 94, [18820] = 69, [18203] = 15, [17066] = 59, [17105] = 33, [18832] = 83, [17071] = 49, [18823] = 68, [17110] = 13, [17072] = 26, [18810] = 94, [18811] = 24, [18808] = 23, [18817] = 15, [17063] = 158, [19137] = 143, [19138] = 57, [16866] = 23, [16868] = 31, [16865] = 50, [16861] = 21, [16863] = 41, [16864] = 21, [16867] = 23, [16862] = 31, [16821] = 23, [16823] = 41, [16820] = 25, [16825] = 21, [16826] = 41, [16827] = 21, [16822] = 23, [16824] = 21, [16813] = 23, [16816] = 31, [16815] = 25, [16819] = 41, [16812] = 21, [16817] = 21, [16814] = 23, [16811] = 31, [16854] = 35, [16856] = 21, [16853] = 25, [16857] = 21, [16860] = 21, [16858] = 21, [16855] = 23, [16859] = 31, [16808] = 23, [16807] = 21, [16809] = 25, [16804] = 31, [16805] = 21, [16806] = 21, [16810] = 35, [16803] = 21, [16846] = 46, [16848] = 41, [16845] = 50, [16850] = 41, [16852] = 52, [16851] = 41, [16847] = 46, [16849] = 41, [16795] = 46, [16797] = 21, [16798] = 25, [16799] = 21, [16801] = 21, [16802] = 21, [16796] = 35, [16800] = 41, [16834] = 12, [16836] = 21, [16833] = 25, [16830] = 21, [16831] = 31, [16828] = 21, [16835] = 23, [16829] = 21, [19370] = 75, [19372] = 43, [19371] = 15, [19348] = 15, [19346] = 93, [19373] = 13, [19350] = 44, [19394] = 78, [19398] = 39, [19399] = 16, [19400] = 52, [19402] = 73, [19365] = 38, [19353] = 44, [19355] = 44, [19397] = 73, [19395] = 145, [19407] = 78, [19405] = 64, [19403] = 87, [19430] = 78, [19367] = 29, [19357] = 88, [19432] = 73, [19431] = 116, [19386] = 55, [19388] = 55, [19392] = 42, [19385] = 124, [19387] = 138, [19361] = 155, [19347] = 100, [19352] = 160, [19003] = 72, [19360] = 112, [19364] = 103, [19356] = 129, [19375] = 108, [19377] = 144, [19378] = 65, [19381] = 82, [19376] = 54, [19379] = 180, [19436] = 92, [19437] = 92, [19438] = 47, [19434] = 77, [19435] = 13, [19362] = 83, [19358] = 97, [19342] = 15, [19341] = 60, [19345] = 15, [19343] = 60, [16963] = 0, [16961] = 68, [16966] = 99, [16959] = 54, [16964] = 41, [16960] = 81, [16962] = 54, [16965] = 45, [16908] = 0, [16832] = 41, [16905] = 99, [16911] = 81, [16907] = 41, [16910] = 41, [16909] = 54, [16906] = 45, [16921] = 0, [16924] = 68, [16923] = 66, [16926] = 81, [16920] = 68, [16925] = 54, [16922] = 68, [16919] = 60, [16955] = 0, [16953] = 27, [16958] = 50, [16951] = 27, [16956] = 27, [16952] = 41, [16954] = 27, [16957] = 45, [16929] = 0, [16932] = 54, [16931] = 83, [16934] = 41, [16928] = 54, [16933] = 68, [16930] = 54, [16927] = 60, [16939] = 0, [16937] = 68, [16942] = 83, [16935] = 68, [16940] = 54, [16936] = 68, [16938] = 68, [16941] = 75, [16914] = 0, [16917] = 41, [16916] = 33, [16918] = 27, [16913] = 81, [16818] = 27, [16915] = 41, [16912] = 15, [16900] = 0, [16902] = 27, [16897] = 66, [16904] = 68, [16899] = 68, [16903] = 27, [16901] = 68, [16898] = 60, [21699] = 38, [21814] = 92, [21708] = 50, [21698] = 55, [21705] = 13, [21704] = 25, [21706] = 50, [21702] = 55, [21700] = 55, [21701] = 100, [21707] = 55, [21703] = 42, [21128] = 88, [21693] = 58, [21694] = 78, [21697] = 39, [21696] = 64, [21692] = 65, [21695] = 58, [21680] = 140, [21681] = 32, [21685] = 15, [21603] = 79, [21690] = 58, [21689] = 52, [21691] = 52, [21688] = 104, [21686] = 41, [21684] = 14, [21683] = 27, [21682] = 57, [21687] = 60, [21669] = 75, [21678] = 60, [21671] = 50, [21672] = 108, [21674] = 68, [21675] = 41, [21676] = 90, [21668] = 15, [21667] = 90, [21648] = 54, [21670] = 120, [21666] = 120, [21673] = 59, [21665] = 110, [21665] = 55, [21627] = 55, [21663] = 136, [21652] = 68, [21651] = 47, [21645] = 28, [21650] = 160, [21635] = 47, [21664] = 78, [21647] = 16, [22402] = 16, [22396] = 0, [21624] = 15, [21623] = 29, [21626] = 63, [21622] = 164, [21677] = 95, [21625] = 63, [22399] = 63, [21621] = 72, [21618] = 114, [21619] = 57, [21617] = 114, [21620] = 126, [21616] = 32, [20930] = 138, [21602] = 62, [21599] = 47, [21598] = 62, [21600] = 31, [21601] = 87, [21597] = 138, [20926] = 104, [21608] = 138, [21604] = 149, [21605] = 16, [21609] = 31, [21607] = 31, [21606] = 16, [21679] = 52, [21615] = 138, [21611] = 62, [23558] = 18, [23570] = 138, [21610] = 18, [23557] = 69, [20927] = 104, [20931] = 87, [22732] = 125, [21583] = 93, [22731] = 93, [22730] = 148, [21582] = 148, [21586] = 148, [21585] = 148, [21581] = 148, [21596] = 104, [21579] = 21, [21839] = 194, [21126] = 194, [21134] = 168, [20929] = 91, [20933] = 91, [21221] = 125, [21838] = 58, [21888] = 12, [21889] = 13, [21856] = 20, [21837] = 102, [21836] = 78, [21891] = 58, [21237] = 170, [21232] = 170, [20928] = 114, [20932] = 114, ")
                --editBox:SetText("")
                editBox:SetFocus()
                editBox:HighlightText(false)

                local button = _G[this:GetName() .. "Button2"]
                button:ClearAllPoints()
                button:SetWidth(200)
                button:SetPoint("CENTER", editBox, "CENTER", 0, -30)
            end,
            OnHide = NOP,
            OnAccept = function(this, ...)

                local editbox = _G[this:GetParent():GetName() .. "WideEditBox"] or _G[this:GetName() .. "EditBox"]

                local importstring = "CEPIGP_DATA_OVERRIDES = {" .. editbox:GetText() .. "}"

                local _, err = loadstring(importstring)
                if not err then
                    assert(loadstring(importstring))()
                    
                    CEPGP.Overrides = {}
                    local idTable = {}
                    local i = 1                

                    for id, _ in pairs (CEPIGP_DATA_OVERRIDES) do
                        idTable[i] = id
                        i = i + 1
                    end
                    i = 1

                    local limit = #idTable

                    CEPIGP_Timer = C_Timer.NewTicker(0.05, function()

                        local id = idTable[i]
                        local gp = CEPIGP_DATA_OVERRIDES[id]
                    
                        local link = CEPGP_getItemLink(id)
                        
                        if link ~= nil then                            
                            i = i + 1
                            if i == limit then
                                CEPIGP_Timer:Cancel()
                            end
                            
                            if CEPGP_itemExists(id) then
                                CEPGP.Overrides[link] = gp
                                CEPGP_print(math.floor(i/limit*100) .. "%  " ..  i .. " " .. limit .. "  GP value for " .. link .. " |c006969FFhas been overriden to " .. gp)
                            else
                                print("ERROR: Item " .. id .. " does not exist")
                            end

                            CEPGP_UpdateOverrideScrollBar()
                        else
                           print("[" .. id .. "] link: is ", link)
                        end

                    end)
                --    print("Successfully imported " .. count .. " overridden items")
                --else
                --    print("Invalid format, use /cepdata export for a valid one")
                
                    CEPGP_override:Show()
                end
            end,
            OnCancel = NOP,
            EditBoxOnEscapePressed = function(this, ...)
                this:GetParent():Hide()
            end,
            timeout = 0,
            whileDead = 1,
            hideOnEscape = 1
        }
        
    StaticPopup_Show("CEPIGP_IMPORT", export_text)
end